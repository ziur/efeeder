<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
  xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

    <changeSet author="roger" id="fellow_dinner.table">
        <createTable catalogName="efeeder" tableName="fellow_dinner">
            <column name="id"   type="INT(11)" autoIncrement="true">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="name" type="VARCHAR(200)"/>
            <column name="nick" type="VARCHAR(120)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet author="roger" id="createIndex.fellow_dinner_id_uindex">
        <createIndex catalogName="efeeder"
                indexName="fellow_dinner_id_uindex"
                tableName="fellow_dinner"
                unique="true">
            <column name="id"/>
        </createIndex>
    </changeSet>

    <changeSet author="roger" id="createIndex.fellow_dinner_nick_uindex">
        <createIndex catalogName="efeeder"
                indexName="fellow_dinner_nick_uindex"
                tableName="fellow_dinner"
                unique="true">
            <column name="nick"/>
        </createIndex>
    </changeSet>

    <changeSet author="roger" id="food_meeting.table">
        <createTable catalogName="efeeder" tableName="food_meeting">
            <column name="id"         type="INT(11)" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name"             type="VARCHAR(200)"/>
            <column name="created_at"       type="DATETIME"/>
            <column name="fellow_dinner_id" type="INT(11)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet author="roger" id="addForeignKeyConstraint.food_meeting_fellow_dinner_id_fk">
        <addForeignKeyConstraint baseColumnNames="fellow_dinner_id"
                baseTableName="food_meeting"
                constraintName="food_meeting_fellow_dinner_id_fk"
                onDelete="CASCADE"
                onUpdate="RESTRICT"
                referencedColumnNames="id"
                referencedTableName="fellow_dinner"/>
    </changeSet>
    
    <changeSet author="roger" id="createIndex.food_meeting_fellow_dinner_id_fk">
        <createIndex catalogName="efeeder"
                indexName="food_meeting_fellow_dinner_id_fk"
                tableName="food_meeting">
            <column name="fellow_dinner_id"/>
        </createIndex>
    </changeSet>

    <changeSet author="roger" id="insert.fellow_dinner.porky">
        <insert catalogName="efeeder"
                tableName="fellow_dinner">
            <column name="name" value="porky"/>
            <column name="nick" value="porky"/>
        </insert>
    </changeSet>
    
    <changeSet author="roger" id="insert.food_meeting.Trancapechos">
        <insert catalogName="efeeder"
                tableName="food_meeting">
            <column name="name"             value="Trancapechos"/>
            <column name="created_at"       value="now()"/>
            <column name="fellow_dinner_id" value="1"/>
        </insert>
    </changeSet>

    <changeSet author="roger" id="insert.fellow_dinner.calama">
        <insert catalogName="efeeder"
                tableName="fellow_dinner">
                <column name="name" value="Rellenos Calama"/>
                <column name="nick" value="Calama"/>
        </insert>
    </changeSet>

    <changeSet author="roger" id="insert.food_meeting.relleno">
        <insert catalogName="efeeder"
                tableName="food_meeting">
                <column name="name"             value="Rellenos"/>
                <column name="created_at"       value="now()"/>
                <column name="fellow_dinner_id" value="2"/>
        </insert>
    </changeSet>

    <changeSet author="rodrigo" id="user.table">
        <createTable catalogName="efeeder" tableName="user">
            <column name="id"   type="INT(11)" autoIncrement="true">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="name"      type="VARCHAR(200)"/>
            <column name="last_name" type="VARCHAR(200)"/>
            <column name="username"  type="VARCHAR(200)">
                <constraints nullable="false"/>
            </column>
            <column name="password"  type="VARCHAR(200)">
                <constraints nullable="false"/>
            </column>
            <column name="email"     type="VARCHAR(120)">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <createIndex catalogName="efeeder"
                indexName="user_id_uindex"
                tableName="user"
                unique="true">
            <column name="id"/>
        </createIndex>
        <createIndex catalogName="efeeder"
                indexName="user_email_uindex"
                tableName="user"
                unique="true">
            <column name="email"/>
        </createIndex>
    </changeSet>

    <changeSet author="roger" id="insert.user.test">
        <insert catalogName="efeeder"
                tableName="user">
                <column name="name"      value="Test"/>
                <column name="last_name" value="Test"/>
                <column name="username"  value="Test"/>
                <column name="password"  value="Test"/>
                <column name="email"     value="test@test.com"/>
        </insert>
    </changeSet>

    <changeSet author="roger" id="insert.user.alejandro">
        <insert catalogName="efeeder"
                tableName="user">
                <column name="name"      value="Alejandro"/>
                <column name="last_name" value="Ruiz"/>
                <column name="username"  value="ARuiz"/>
                <column name="password"  value="ARuiz"/>
                <column name="email"     value="alejandro.ruiz@jalasoft.com"/>
        </insert>
    </changeSet>

    <changeSet author="roger" id="insert.user.amir">
        <insert catalogName="efeeder"
                tableName="user">
                <column name="name"      value="Amir"/>
                <column name="last_name" value="Aranibar"/>
                <column name="username"  value="AAranibar"/>
                <column name="password"  value="AAranibar"/>
                <column name="email"     value="amir.aranibar@jalasoft.com"/>
        </insert>
    </changeSet>

    <changeSet author="roger" id="insert.user.ricardo">
        <insert catalogName="efeeder"
                tableName="user">
                <column name="name"      value="Ricardo"/>
                <column name="last_name" value="Ramirez"/>
                <column name="username"  value="RRamirez"/>
                <column name="password"  value="RRamirez"/>
                <column name="email"     value="ricardo.ramirez@jalasoft.com"/>
        </insert>
    </changeSet>

    <changeSet author="roger" id="createtable.order">
        <createTable catalogName="efeeder" tableName="orders">
            <column name="id_food_meeting" type="INT"/>
            <column name="id_user"         type="INT"/>
            <column name="order_name"      type="VARCHAR(200)"/>
            <column name="Cost"            type="NUMBER"/>
        </createTable>
    </changeSet>

    <changeSet author="roger" id="addPrimaryKey.table.order">
        <addPrimaryKey catalogName="efeeder"
                columnNames="id_food_meeting, id_user"
                constraintName="pk_orders"
                tableName="orders"/>
    </changeSet>

    <changeSet author="roger" id="addForeignKeyConstraint.fk_id_food_meeting">
        <addForeignKeyConstraint baseColumnNames="id_food_meeting"
                baseTableName="orders"
                constraintName="fk_id_food_meeting"
                onDelete="CASCADE"
                onUpdate="RESTRICT"
                referencedColumnNames="id"
                referencedTableName="food_meeting"/>
    </changeSet>

    <changeSet author="roger" id="addForeignKeyConstraint.fk_id_user">
        <addForeignKeyConstraint baseColumnNames="id_user"
                baseTableName="orders"
                constraintName="fk_id_user"
                onDelete="CASCADE"
                onUpdate="RESTRICT"
                referencedColumnNames="id"
                referencedTableName="user"/>
    </changeSet>

    <changeSet author="alexander" id="createtable.buyer">
        <createTable catalogName="efeeder" tableName="buyer">
            <column name="id_food_meeting" type="INT"/>
            <column name="id_user"         type="INT"/>
        </createTable>
    </changeSet>

    <changeSet author="alexander" id="addPrimaryKey.table.buyer">
        <addPrimaryKey catalogName="efeeder"
                columnNames="id_food_meeting, id_user"
                constraintName="pk_buyer"
                tableName="buyer"/>
    </changeSet>

    <changeSet author="alexander" id="addForeignKeyConstraint.fk_id_food_meeting_by_buyer">
        <addForeignKeyConstraint baseColumnNames="id_food_meeting"
                baseTableName="buyer"
                constraintName="fk_id_food_meeting_by_buyer"
                onDelete="CASCADE"
                onUpdate="RESTRICT"
                referencedColumnNames="id"
                referencedTableName="food_meeting"/>
    </changeSet>

    <changeSet author="alexander" id="addForeignKeyConstraint.fk_id_user_by_buyer">
        <addForeignKeyConstraint baseColumnNames="id_user"
                baseTableName="buyer"
                constraintName="fk_id_user_by_buyer"
                onDelete="CASCADE"
                onUpdate="RESTRICT"
                referencedColumnNames="id"
                referencedTableName="user"/>
    </changeSet>

    <changeSet author="amir" id="suggestions.table">
        <createTable catalogName="efeeder" tableName="suggestions">
            <column name="id"   type="INT(11)" autoIncrement="true">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="id_user"     type="INT(11)">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="Text"/>
            <column name="created_at"  type="DATETIME"/>
        </createTable>
        <addForeignKeyConstraint baseColumnNames="id_user"
                baseTableName="suggestions"
                constraintName="suggestions_id_user_fk"
                onDelete="CASCADE"
                onUpdate="RESTRICT"
                referencedColumnNames="id"
                referencedTableName="user"/>
        <createIndex catalogName="efeeder"
                indexName="suggestions_id_user_fk"
                tableName="suggestions"
                unique="true">
            <column name="id_user"/>
        </createIndex>
    </changeSet>
    
    <changeSet author="ricardo" id="food_meeting_user.table">
        <createTable catalogName="efeeder" tableName="food_meeting_user">
            <column name="id_food_meeting" type="INT(11)">
                <constraints nullable="false"/>
            </column>
            <column name="id_user" type="INT(11)">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <addForeignKeyConstraint baseColumnNames="id_food_meeting"
                baseTableName="food_meeting_user"
                constraintName="food_meeting_user_id_food_meeting_fk"
                onDelete="CASCADE"
                onUpdate="RESTRICT"
                referencedColumnNames="id"
                referencedTableName="food_meeting"/>
        <addForeignKeyConstraint baseColumnNames="id_user"
                baseTableName="food_meeting_user"
                constraintName="food_meeting_user_id_user_fk"
                onDelete="CASCADE"
                onUpdate="RESTRICT"
                referencedColumnNames="id"
                referencedTableName="user"/>
    </changeSet>
    
    <changeSet author="alexander" id="createtable.votes">
        <createTable catalogName="efeeder" tableName="votes">
            <column name="id" type="INT(11)" autoIncrement="true">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="id_food_meeting" type="INT(11)">
                <constraints nullable="false"/>
            </column>
            <column name="id_suggestion"  type="INT(11)">
                <constraints nullable="false"/>
            </column>
            <column name="counter" type="INT(11)"/>
        </createTable>
        <addForeignKeyConstraint baseColumnNames="id_food_meeting"
            baseTableName="votes"
            constraintName="votes_id_food_meeting_fk"
            onDelete="CASCADE"
            onUpdate="RESTRICT"
            referencedColumnNames="id"
            referencedTableName="food_meeting"/>
        <addForeignKeyConstraint baseColumnNames="id_suggestion"
            baseTableName="votes"
            constraintName="votes_id_suggestion_fk"
            onDelete="CASCADE"
            onUpdate="RESTRICT"
            referencedColumnNames="id"
            referencedTableName="suggestions"/>
        <createIndex catalogName="efeeder"
                indexName="votes_id_food_meeting_fk"
                tableName="votes"
                unique="true">
            <column name="id_food_meeting"/>
        </createIndex>    
        <createIndex catalogName="efeeder"
                indexName="votes_id_suggestion_fk"
                tableName="votes"
                unique="true">
            <column name="id_suggestion"/>
        </createIndex>    
    </changeSet>

</databaseChangeLog>